# 计算机组成原理



## 第一章	概述



### 1.1计算机发展



计算机系统=软件+硬件

![image-20220919145406472](/Users/apple/Library/Application Support/typora-user-images/image-20220919145406472.png)



主要探讨硬件部分

![image-20220919145712548](/Users/apple/Library/Application Support/typora-user-images/image-20220919145712548.png)



划分代数的标准是处理器



### 1.2计算机系统层次结构



**冯诺依曼机**

存储程序的提出



![image-20220919150745599](/Users/apple/Library/Application Support/typora-user-images/image-20220919150745599.png)



计算机系统中用软件和硬件解决问题在逻辑上等效

![image-20220919151025366](/Users/apple/Library/Application Support/typora-user-images/image-20220919151025366.png)

问题：所有数据都要经过运算器，造成效率低



**现代计算机**以存储器为中心



CPU=运算器+控制器

![image-20220919151249479](/Users/apple/Library/Application Support/typora-user-images/image-20220919151249479.png)



![image-20220919151414452](/Users/apple/Library/Application Support/typora-user-images/image-20220919151414452.png)





**主存的基本组成**

![image-20220919152111073](/Users/apple/Library/Application Support/typora-user-images/image-20220919152111073.png)

 ![image-20220919152440943](/Users/apple/Library/Application Support/typora-user-images/image-20220919152440943.png)





MAR位数反映存储单元个数

MDR位数=存储字长



MAR和MDR在现代计算机中位于CPU中，cache也存在于CPU中



**运算器的基本组成**



![image-20220919153134241](/Users/apple/Library/Application Support/typora-user-images/image-20220919153134241.png)



**控制器的基本组成**



![image-20220919153155837](/Users/apple/Library/Application Support/typora-user-images/image-20220919153155837.png)

![image-20220919154557161](/Users/apple/Library/Application Support/typora-user-images/image-20220919154557161.png)

![image-20220919155539715](/Users/apple/Library/Application Support/typora-user-images/image-20220919155539715.png)



![image-20220919155630026](/Users/apple/Library/Application Support/typora-user-images/image-20220919155630026.png)







![image-20220919160920971](/Users/apple/Library/Application Support/typora-user-images/image-20220919160920971.png)



下层是上层的基础，上层是下层的扩展





### 1.3计算机性能指标



存储器指标

![image-20220919161935363](/Users/apple/Library/Application Support/typora-user-images/image-20220919161935363.png)





![image-20220919162213552](/Users/apple/Library/Application Support/typora-user-images/image-20220919162213552.png)

时钟周期=1/主频



CPI：每一条指令所需的时钟周期数

![image-20220919162402901](/Users/apple/Library/Application Support/typora-user-images/image-20220919162402901.png)

衡量性能时，该指标为平均值

平均耗时：

![image-20220919162444594](/Users/apple/Library/Application Support/typora-user-images/image-20220919162444594.png)



![image-20220919162528985](/Users/apple/Library/Application Support/typora-user-images/image-20220919162528985.png)





IPS：美妙之行多少条指令 

![image-20220919162704361](/Users/apple/Library/Application Support/typora-user-images/image-20220919162704361.png)

![image-20220919162737475](/Users/apple/Library/Application Support/typora-user-images/image-20220919162737475.png)



![image-20220919163317206](/Users/apple/Library/Application Support/typora-user-images/image-20220919163317206.png)







## 第二章	数据的表示和运算



### 定点数的编码表示



无符号整数

机器字长限制无符号整数位数上限

![image-20220920164709758](/Users/apple/Library/Application Support/typora-user-images/image-20220920164709758.png)



减法实现

![image-20220920165018074](/Users/apple/Library/Application Support/typora-user-images/image-20220920165018074.png)

因为减法电路成本更高，所以用加法





**有符号**



原码

![image-20220920165822369](/Users/apple/Library/Application Support/typora-user-images/image-20220920165822369.png)

![image-20220920170018693](/Users/apple/Library/Application Support/typora-user-images/image-20220920170018693.png)



转变为补码的过程中要转换为反码



![image-20220920170154988](/Users/apple/Library/Application Support/typora-user-images/image-20220920170154988.png)



![image-20220920170416707](/Users/apple/Library/Application Support/typora-user-images/image-20220920170416707.png)



负数：从右往左找到第一个1，左边的所有数值位按位取反



补码的加法符号位也要参与运算





补码的减法

![image-20220920171607372](/Users/apple/Library/Application Support/typora-user-images/image-20220920171607372.png)

注意是全部位按位取反，包括符号位





 ![image-20220920180841055](/Users/apple/Library/Application Support/typora-user-images/image-20220920180841055.png)



移码

补码的符号位取反

移码只能用于表示整数



移码方便对比补码的大小



 ![image-20220920181625155](/Users/apple/Library/Application Support/typora-user-images/image-20220920181625155.png)





定点小数

![image-20220920181852742](/Users/apple/Library/Application Support/typora-user-images/image-20220920181852742.png)

![image-20220920182208595](/Users/apple/Library/Application Support/typora-user-images/image-20220920182208595.png)





### 运算方法与运算电路



奇偶校验

![image-20220921122230109](/Users/apple/Library/Application Support/typora-user-images/image-20220921122230109.png)



如果有偶数个位出错，奇偶校验无效



![image-20220921122644689](/Users/apple/Library/Application Support/typora-user-images/image-20220921122644689.png)

奇校验若异或结果为1说明正确，若为0说明错误



**基本运算电路**

![image-20220921124045638](/Users/apple/Library/Application Support/typora-user-images/image-20220921124045638.png)

![image-20220921124228574](/Users/apple/Library/Application Support/typora-user-images/image-20220921124228574.png)

![image-20220921124349606](/Users/apple/Library/Application Support/typora-user-images/image-20220921124349606.png)

 异或

![image-20220921124548978](/Users/apple/Library/Application Support/typora-user-images/image-20220921124548978.png)

 

一位全加器

 ![image-20220921131450179](/Users/apple/Library/Application Support/typora-user-images/image-20220921131450179.png)

![image-20220921131550115](/Users/apple/Library/Application Support/typora-user-images/image-20220921131550115.png)



![image-20220921132104466](/Users/apple/Library/Application Support/typora-user-images/image-20220921132104466.png)







![image-20220921132045215](/Users/apple/Library/Application Support/typora-user-images/image-20220921132045215.png)





并行进位加法器



 

![image-20220921133053695](/Users/apple/Library/Application Support/typora-user-images/image-20220921133053695.png)

不足：电路元件复杂

 



**补码加减运算器**

![image-20220921134033038](/Users/apple/Library/Application Support/typora-user-images/image-20220921134033038.png)

同样也可以用作无符号数的加法/减法运算

无符号数与补码的判断溢出的方式不同





![image-20220921134943023](/Users/apple/Library/Application Support/typora-user-images/image-20220921134943023.png)

![image-20220921134952817](/Users/apple/Library/Application Support/typora-user-images/image-20220921134952817.png)



**标志位的生成**

![image-20220921135129826](/Users/apple/Library/Application Support/typora-user-images/image-20220921135129826.png)





 **定点数的移位运算**



算数移位



**原码**算数移位

![image-20220921140406940](/Users/apple/Library/Application Support/typora-user-images/image-20220921140406940.png)

![image-20220921140506877](/Users/apple/Library/Application Support/typora-user-images/image-20220921140506877.png)

![image-20220921140603869](/Users/apple/Library/Application Support/typora-user-images/image-20220921140603869.png)



**反码**的算数移位

正数与原码相同	

负数补1





**补码**算数移位

![image-20220921140904465](/Users/apple/Library/Application Support/typora-user-images/image-20220921140904465.png)

负数高位补1，低位补0

![image-20220921140933519](/Users/apple/Library/Application Support/typora-user-images/image-20220921140933519.png)





**逻辑移位**

![image-20220921141141711](/Users/apple/Library/Application Support/typora-user-images/image-20220921141141711.png)

（对无符号数的算数移位）



**循环移位**



![image-20220921141514498](/Users/apple/Library/Application Support/typora-user-images/image-20220921141514498.png)

高字节与低字节调换



### 定点数乘除



**乘法**

手算类似十进制



异或决定符号位



 ![image-20220921151029919](/Users/apple/Library/Application Support/typora-user-images/image-20220921151029919.png)



![image-20220921151141775](/Users/apple/Library/Application Support/typora-user-images/image-20220921151141775.png)

每次加法，每次逻辑移位



手算模拟

![image-20220921151601777](/Users/apple/Library/Application Support/typora-user-images/image-20220921151601777.png)

 

**补码的一位乘法**



  ![image-20220921152113091](/Users/apple/Library/Application Support/typora-user-images/image-20220921152113091.png)







![image-20220921152230387](/Users/apple/Library/Application Support/typora-user-images/image-20220921152230387.png)

被乘数双符号位，乘数单符号位





**除法**



原码除法（恢复余数法）



 ![image-20220921160609840](/Users/apple/Library/Application Support/typora-user-images/image-20220921160609840.png)

![image-20220921160621970](/Users/apple/Library/Application Support/typora-user-images/image-20220921160621970.png)

相减结果为1则恢复为0在吧acc的值加回去，恢复原样



然后逻辑左移末尾补0

![image-20220921161527535](/Users/apple/Library/Application Support/typora-user-images/image-20220921161527535.png)



加减交替（不恢复余数法）

 ![image-20220921161805769](/Users/apple/Library/Application Support/typora-user-images/image-20220921161805769.png)

![image-20220921162450557](/Users/apple/Library/Application Support/typora-user-images/image-20220921162450557.png)

最后一位可能要恢复余数

第一步如果商1的话说明被除数比除数大

而顶点小数除法结果只能是顶点小数

所以第一步商为1，不能用定点小数表示





补码除法（加减交替法）

![image-20220921164038443](/Users/apple/Library/Application Support/typora-user-images/image-20220921164038443.png)

![image-20220921164154492](/Users/apple/Library/Application Support/typora-user-images/image-20220921164154492.png)

![image-20220921164513231](/Users/apple/Library/Application Support/typora-user-images/image-20220921164513231.png)

![image-20220921164548379](/Users/apple/Library/Application Support/typora-user-images/image-20220921164548379.png)



### C语言强制类型转换



定点整数全部用补码存储

![image-20220921164831096](/Users/apple/Library/Application Support/typora-user-images/image-20220921164831096.png)

无符号转有符号直接复制，然后改变解释方式

![image-20220921164920607](/Users/apple/Library/Application Support/typora-user-images/image-20220921164920607.png)

长整形转短整形，高位截断，低位保留



短整形变长整形

符号拓展





### 数据的存储和排列



大小端模式

![image-20220921165545498](/Users/apple/Library/Application Support/typora-user-images/image-20220921165545498.png)



小端便于机器处理



 ![image-20220921170033902](/Users/apple/Library/Application Support/typora-user-images/image-20220921170033902.png)





### 浮点数



![image-20220922145009602](/Users/apple/Library/Application Support/typora-user-images/image-20220922145009602.png)

  



规格化

![image-20220922145739374](/Users/apple/Library/Application Support/typora-user-images/image-20220922145739374.png)

![image-20220922145836479](/Users/apple/Library/Application Support/typora-user-images/image-20220922145836479.png)



![image-20220922150204714](/Users/apple/Library/Application Support/typora-user-images/image-20220922150204714.png)



补码负数的尾数最高位是0，正数为1







IEEE

![image-20220922151548909](/Users/apple/Library/Application Support/typora-user-images/image-20220922151548909.png)



短浮点数真值范围：-126～127

全0全1作特殊用途

![image-20220922152427863](/Users/apple/Library/Application Support/typora-user-images/image-20220922152427863.png)

![image-20220922163255165](/Users/apple/Library/Application Support/typora-user-images/image-20220922163255165.png)





浮点数的加减





![image-20220922170043595](/Users/apple/Library/Application Support/typora-user-images/image-20220922170043595.png)



强制类型转换



![image-20220922170343117](/Users/apple/Library/Application Support/typora-user-images/image-20220922170343117.png)





## 第三章	存储系统



### 存储系统基本概念



多级存储系统

大容量，高速度，低成本之间的矛盾



![image-20220923073331508](/Users/apple/Library/Application Support/typora-user-images/image-20220923073331508.png)



 ![image-20220923073422577](/Users/apple/Library/Application Support/typora-user-images/image-20220923073422577.png)

 ![image-20220923073614743](/Users/apple/Library/Application Support/typora-user-images/image-20220923073614743.png)

![image-20220923073800841](/Users/apple/Library/Application Support/typora-user-images/image-20220923073800841.png)



**性能指标**

![image-20220923073854964](/Users/apple/Library/Application Support/typora-user-images/image-20220923073854964.png)

![image-20220923073922437](/Users/apple/Library/Application Support/typora-user-images/image-20220923073922437.png)





cache和主存能被cpu直接读写







### 主存



**存储器原理**

数字电路内容



![image-20220923075709628](/Users/apple/Library/Application Support/typora-user-images/image-20220923075709628.png)



SRAM/DRAM

![image-20220923080130704](/Users/apple/Library/Application Support/typora-user-images/image-20220923080130704.png)

![image-20220923080155898](/Users/apple/Library/Application Support/typora-user-images/image-20220923080155898.png)



![image-20220923080420288](/Users/apple/Library/Application Support/typora-user-images/image-20220923080420288.png)



栅极电容放电是破坏性读出，需要重写再生

双稳态读出数据是非破坏性

![image-20220923080642342](/Users/apple/Library/Application Support/typora-user-images/image-20220923080642342.png)





![image-20220923080705539](/Users/apple/Library/Application Support/typora-user-images/image-20220923080705539.png)



![image-20220923080920965](/Users/apple/Library/Application Support/typora-user-images/image-20220923080920965.png)



DRAM的刷新

![image-20220923081126676](/Users/apple/Library/Application Support/typora-user-images/image-20220923081126676.png)

通过行列地址进行译码

用行列地址可以减少选通线的数量



刷新由存储器独立完成，不需要CPU控制

![image-20220923081657448](/Users/apple/Library/Application Support/typora-user-images/image-20220923081657448.png)



![image-20220923081906734](/Users/apple/Library/Application Support/typora-user-images/image-20220923081906734.png)



地址线复用技术（第一次先送行，下一次送列）可以使地址线更少，芯片引脚更少



目前的主存通常采用SDRAM





**ROM**



 ![image-20220923082616888](/Users/apple/Library/Application Support/typora-user-images/image-20220923082616888.png)

![image-20220923082624297](/Users/apple/Library/Application Support/typora-user-images/image-20220923082624297.png)



![image-20220923082916390](/Users/apple/Library/Application Support/typora-user-images/image-20220923082916390.png)

 



逻辑上BIOS算在主存内，所以主存由ROM+RAM组成



![image-20220923083019061](/Users/apple/Library/Application Support/typora-user-images/image-20220923083019061.png)





### 主存储器与CPU之间的连接



字扩展

位扩展

同时扩展

 



译码器

![image-20220923091114860](/Users/apple/Library/Application Support/typora-user-images/image-20220923091114860.png)

![image-20220923091133985](/Users/apple/Library/Application Support/typora-user-images/image-20220923091133985.png)



双端口RAM和多模块存储器

（提升主存速度）



双端口RAM

![image-20220923092050999](/Users/apple/Library/Application Support/typora-user-images/image-20220923092050999.png)



多体并行存储

![image-20220923092232913](/Users/apple/Library/Application Support/typora-user-images/image-20220923092232913.png)

体号表示选择哪个存储器

![image-20220923092734744](/Users/apple/Library/Application Support/typora-user-images/image-20220923092734744.png)



![image-20220923093009462](/Users/apple/Library/Application Support/typora-user-images/image-20220923093009462.png)

![image-20220923093215968](/Users/apple/Library/Application Support/typora-user-images/image-20220923093215968.png)





高位交叉相当于单纯扩容

低位交叉称为双通道



### 外存



![image-20220923094813077](/Users/apple/Library/Application Support/typora-user-images/image-20220923094813077.png)



磁盘性能指标

![image-20220923095603341](/Users/apple/Library/Application Support/typora-user-images/image-20220923095603341.png)



所有磁道记录数据量相同

所以越内侧位密度越大



![image-20220923095758863](/Users/apple/Library/Application Support/typora-user-images/image-20220923095758863.png)



![image-20220923100420888](/Users/apple/Library/Application Support/typora-user-images/image-20220923100420888.png)



![image-20220923100706157](/Users/apple/Library/Application Support/typora-user-images/image-20220923100706157.png)





磁盘阵列

![image-20220923100819014](/Users/apple/Library/Application Support/typora-user-images/image-20220923100819014.png)



固态硬盘 ![image-20220923101630834](/Users/apple/Library/Application Support/typora-user-images/image-20220923101630834.png)









### Cache





Cachae和主存的映射方式



![image-20220923163139980](/Users/apple/Library/Application Support/typora-user-images/image-20220923163139980.png)

 由于空的cache块中存放0，可能引起歧义，因此再设置一位有效位表示当前的标记是否有效



全相联映射（随机）

![image-20220923163754064](/Users/apple/Library/Application Support/typora-user-images/image-20220923163754064.png)

![image-20220923164013045](/Users/apple/Library/Application Support/typora-user-images/image-20220923164013045.png)



直接映射

![image-20220923164508486](/Users/apple/Library/Application Support/typora-user-images/image-20220923164508486.png)

![image-20220923164551476](/Users/apple/Library/Application Support/typora-user-images/image-20220923164551476.png)





组相联映射

![image-20220923164722826](/Users/apple/Library/Application Support/typora-user-images/image-20220923164722826.png)

 ![image-20220923164922856](/Users/apple/Library/Application Support/typora-user-images/image-20220923164922856.png)





![image-20220923165016877](/Users/apple/Library/Application Support/typora-user-images/image-20220923165016877.png)



![image-20220923165232085](/Users/apple/Library/Application Support/typora-user-images/image-20220923165232085.png)





随机RAND：没有考虑局部性

FIFO：也没有考虑局部性

LRU近期最少使用：

每个块加个计数器

![image-20220923170042149](/Users/apple/Library/Application Support/typora-user-images/image-20220923170042149.png)

计数器反映这个块多久未被访问

 ![image-20220923170534268](/Users/apple/Library/Application Support/typora-user-images/image-20220923170534268.png)



考虑到局部性原理

![image-20220923170619291](/Users/apple/Library/Application Support/typora-user-images/image-20220923170619291.png)



最不经常食用的算法

计数器记录从头开始每个块被访问多少次

当需要换出时选择计数器最小的进行换出

多个计数器相同时调出时可以按行号排列，也可fifo

![image-20220923170905901](/Users/apple/Library/Application Support/typora-user-images/image-20220923170905901.png)



 

**cache的写策略**

修改cache中的数据如何保持其与主存中的一致



写命中



![image-20220923171152218](/Users/apple/Library/Application Support/typora-user-images/image-20220923171152218.png)

只修改cache，当调出cache时才换出内存

设置脏位表示是否修改

![image-20220923171257355](/Users/apple/Library/Application Support/typora-user-images/image-20220923171257355.png)



![image-20220923171314312](/Users/apple/Library/Application Support/typora-user-images/image-20220923171314312.png)

![image-20220923171327910](/Users/apple/Library/Application Support/typora-user-images/image-20220923171327910.png)

![image-20220923171430787](/Users/apple/Library/Application Support/typora-user-images/image-20220923171430787.png)





写不命中



![image-20220923171512440](/Users/apple/Library/Application Support/typora-user-images/image-20220923171512440.png)

修改主存后调入cache



![image-20220923171552072](/Users/apple/Library/Application Support/typora-user-images/image-20220923171552072.png)

修改主存后不调入cache







## 第四章	指令系统



控制器支持的指令



### 指令格式

操作码+地址码



根据地址码个数分类



零地址指令

![image-20220924154407051](/Users/apple/Library/Application Support/typora-user-images/image-20220924154407051.png)



一地址指令

![image-20220924155443134](/Users/apple/Library/Application Support/typora-user-images/image-20220924155443134.png)

 

二，三地址指令

![image-20220924155622180](/Users/apple/Library/Application Support/typora-user-images/image-20220924155622180.png)



四地址指令

![image-20220924155638623](/Users/apple/Library/Application Support/typora-user-images/image-20220924155638623.png)

![image-20220924155716931](/Users/apple/Library/Application Support/typora-user-images/image-20220924155716931.png)





![image-20220924155826901](/Users/apple/Library/Application Support/typora-user-images/image-20220924155826901.png)





指令字长：指令总长度

![image-20220924160003670](/Users/apple/Library/Application Support/typora-user-images/image-20220924160003670.png)

![image-20220924160013374](/Users/apple/Library/Application Support/typora-user-images/image-20220924160013374.png)

![image-20220924160030407](/Users/apple/Library/Application Support/typora-user-images/image-20220924160030407.png)



定长操作码的译码电路设计简单，但灵活性差

可变长操作码的译码电路复杂，但灵活性高





按操作类型分类

![image-20220924160610854](/Users/apple/Library/Application Support/typora-user-images/image-20220924160610854.png)





**扩展操作码指令**



定长指令字结构+变长操作码

不同地址数的指令使用不同长度的操作码





![image-20220924162209852](/Users/apple/Library/Application Support/typora-user-images/image-20220924162209852.png)

![image-20220924162220914](/Users/apple/Library/Application Support/typora-user-images/image-20220924162220914.png)



![image-20220924163405454](/Users/apple/Library/Application Support/typora-user-images/image-20220924163405454.png)

![image-20220924163458412](/Users/apple/Library/Application Support/typora-user-images/image-20220924163458412.png)







### 寻址方式



**指令寻址**

PC始终存放下一条要执行的指令





顺序寻址

每一次令PC加上指令长



跳跃寻址

由跳跃指令指出

JMP无条件转移





**数据寻址**

确定本条指令地址码指明的真实地址

可以在地址码前加几位来表示寻址方式

![image-20220924190928695](/Users/apple/Library/Application Support/typora-user-images/image-20220924190928695.png)



接下来认为：指令字长=机器字长=存储字长



1.直接寻址

地址码中的地址就是真实的地址

![image-20220924191152559](/Users/apple/Library/Application Support/typora-user-images/image-20220924191152559.png)

优点：简单，不需要地址转换

缺点：寻址范围首受限，操作数的地址不易更改



2.简介寻址

EA=（A）

![image-20220924191417620](/Users/apple/Library/Application Support/typora-user-images/image-20220924191417620.png)

一次间接寻址需3次访存



![image-20220924191451807](/Users/apple/Library/Application Support/typora-user-images/image-20220924191451807.png)

![image-20220924191556905](/Users/apple/Library/Application Support/typora-user-images/image-20220924191556905.png)





3.寄存器寻址

EA指向某个寄存器

![image-20220924191647033](/Users/apple/Library/Application Support/typora-user-images/image-20220924191647033.png)

![image-20220924191655337](/Users/apple/Library/Application Support/typora-user-images/image-20220924191655337.png)

![image-20220924191709032](/Users/apple/Library/Application Support/typora-user-images/image-20220924191709032.png)





4.寄存器简介寻址

![image-20220924191735189](/Users/apple/Library/Application Support/typora-user-images/image-20220924191735189.png)

![image-20220924191751577](/Users/apple/Library/Application Support/typora-user-images/image-20220924191751577.png)



5.隐含寻址



![image-20220924191824156](/Users/apple/Library/Application Support/typora-user-images/image-20220924191824156.png)



6.立即寻址

操作数直接写在了指令地址码部分，一般采用补码

![image-20220924191928780](/Users/apple/Library/Application Support/typora-user-images/image-20220924191928780.png)

#表示立即寻址

![image-20220924192002122](/Users/apple/Library/Application Support/typora-user-images/image-20220924192002122.png)



**偏移寻址**

![image-20220924192442598](/Users/apple/Library/Application Support/typora-user-images/image-20220924192442598.png)



7.基址寻址

BR（基址寄存器）指向当前程序起始地址

![image-20220924192630800](/Users/apple/Library/Application Support/typora-user-images/image-20220924192630800.png)

“重定位寄存器”就是基址寄存器



有时候用通用寄存器来代替基址寄存器的作用

![image-20220924192734242](/Users/apple/Library/Application Support/typora-user-images/image-20220924192734242.png)

 

优点：可扩大寻址范围，不必考虑程序位于主存的位置有利于多道程序设计（便于并发运行）



![image-20220924193214607](/Users/apple/Library/Application Support/typora-user-images/image-20220924193214607.png)

![image-20220924193258209](/Users/apple/Library/Application Support/typora-user-images/image-20220924193258209.png)



8.变址寄存器

变址寄存器IX

![image-20220924193405531](/Users/apple/Library/Application Support/typora-user-images/image-20220924193405531.png)

可修改IX，视为偏移量

![image-20220924194120009](/Users/apple/Library/Application Support/typora-user-images/image-20220924194120009.png)

 ![image-20220924194144437](/Users/apple/Library/Application Support/typora-user-images/image-20220924194144437.png)



9.相对寻址

![image-20220924194457783](/Users/apple/Library/Application Support/typora-user-images/image-20220924194457783.png)



![image-20220924195013828](/Users/apple/Library/Application Support/typora-user-images/image-20220924195013828.png)

A是相对于下一条指令的位移量





![image-20220924195202127](/Users/apple/Library/Application Support/typora-user-images/image-20220924195202127.png)





10.堆栈寻址

![image-20220924195817350](/Users/apple/Library/Application Support/typora-user-images/image-20220924195817350.png)



![image-20220924200115029](/Users/apple/Library/Application Support/typora-user-images/image-20220924200115029.png)



硬堆栈pop，push不需要访存

![image-20220924200255654](/Users/apple/Library/Application Support/typora-user-images/image-20220924200255654.png)





### 机器级代码表示



![image-20220925103228949](/Users/apple/Library/Application Support/typora-user-images/image-20220925103228949.png)





X86寄存器



通用寄存器：EAX，EBX，ECX，EDX（X=未知）

![image-20220925103623368](/Users/apple/Library/Application Support/typora-user-images/image-20220925103623368.png)

变址寄存器通常用于线性表和字符串

堆栈寄存器用于实现函数调用





e开头都是寄存器（extended），且是32bit

去掉E就是使用低16bit

![image-20220925103849055](/Users/apple/Library/Application Support/typora-user-images/image-20220925103849055.png)







只有通用寄存器可以灵活使用



![image-20220925103919854](/Users/apple/Library/Application Support/typora-user-images/image-20220925103919854.png)



例子

![image-20220925104255302](/Users/apple/Library/Application Support/typora-user-images/image-20220925104255302.png)





常用x86指令





运算

![image-20220925105312301](/Users/apple/Library/Application Support/typora-user-images/image-20220925105312301.png)

最终运算结果要放回d所指位置

所以d不可以是常量，只能是寄存器或主存的地址





edx:eax/s   是对被除数进行位扩展为64位





逻辑指令

![image-20220925110127638](/Users/apple/Library/Application Support/typora-user-images/image-20220925110127638.png)





![image-20220925110326176](/Users/apple/Library/Application Support/typora-user-images/image-20220925110326176.png)





intel格式和at&t格式

![image-20220925110515913](/Users/apple/Library/Application Support/typora-user-images/image-20220925110515913.png)



选择语句



![image-20220925114628540](/Users/apple/Library/Application Support/typora-user-images/image-20220925114628540.png)



![image-20220925114832043](/Users/apple/Library/Application Support/typora-user-images/image-20220925114832043.png)



![image-20220925115025058](/Users/apple/Library/Application Support/typora-user-images/image-20220925115025058.png)

![image-20220925115031947](/Users/apple/Library/Application Support/typora-user-images/image-20220925115031947.png)





条件转移指令——jxxx



![image-20220925115407457](/Users/apple/Library/Application Support/typora-user-images/image-20220925115407457.png)





cmp指令的底层原理

![image-20220925120212167](/Users/apple/Library/Application Support/typora-user-images/image-20220925120212167.png)





循环语句（条件转移指令）



![image-20220925120523052](/Users/apple/Library/Application Support/typora-user-images/image-20220925120523052.png)



用loop实现循环



![image-20220925120701384](/Users/apple/Library/Application Support/typora-user-images/image-20220925120701384.png)

ecx的特殊功能是循环计数器，不能用其他通用寄存器替代



![image-20220925120933188](/Users/apple/Library/Application Support/typora-user-images/image-20220925120933188.png)

![image-20220925124553807](/Users/apple/Library/Application Support/typora-user-images/image-20220925124553807.png)







## 第五章	中央处理器



### CPU功能和基本结构



![image-20220925132525431](/Users/apple/Library/Application Support/typora-user-images/image-20220925132525431.png)

![image-20220925132741318](/Users/apple/Library/Application Support/typora-user-images/image-20220925132741318.png)



运算器基本结构

1.算数逻辑单元

2.通用基本寄存器

![image-20220925132855350](/Users/apple/Library/Application Support/typora-user-images/image-20220925132855350.png)

3.暂存寄存器

4.累加寄存器

5.程序状态字寄存器

6.移位器

7.计数器







![image-20220925133123015](/Users/apple/Library/Application Support/typora-user-images/image-20220925133123015.png)

![image-20220925133148221](/Users/apple/Library/Application Support/typora-user-images/image-20220925133148221.png)



![image-20220925133241492](/Users/apple/Library/Application Support/typora-user-images/image-20220925133241492.png)



相对于专用数据通路的是CPU内部单总线方式



![image-20220925133443387](/Users/apple/Library/Application Support/typora-user-images/image-20220925133443387.png)

![image-20220925133451024](/Users/apple/Library/Application Support/typora-user-images/image-20220925133451024.png)

![image-20220925133645332](/Users/apple/Library/Application Support/typora-user-images/image-20220925133645332.png)







控制器的基本结构

![image-20220925134407784](/Users/apple/Library/Application Support/typora-user-images/image-20220925134407784.png)







用户可见寄存器：PC；PSW，ACC，R0等通用寄存器



对用户不可见的：IR，MAR，MDR，移位寄存器，暂存寄存器





![image-20220925134600155](/Users/apple/Library/Application Support/typora-user-images/image-20220925134600155.png)







### 指令周期



![image-20220925141328116](/Users/apple/Library/Application Support/typora-user-images/image-20220925141328116.png)



机器周期是完成一个操作的时间

![image-20220925141823064](/Users/apple/Library/Application Support/typora-user-images/image-20220925141823064.png)

![image-20220925141933965](/Users/apple/Library/Application Support/typora-user-images/image-20220925141933965.png)

指令周期流程



设置四个触发器表示当前处于哪个机器周期



4个阶段都有可能有方寸操作，但是访存目的不同







取指周期的数据流

![image-20220925142354449](/Users/apple/Library/Application Support/typora-user-images/image-20220925142354449.png)



间址周期的数据流

![image-20220925142643355](/Users/apple/Library/Application Support/typora-user-images/image-20220925142643355.png)



执行周期没有统一的数据流向





中断周期的数据流

![image-20220925143219592](/Users/apple/Library/Application Support/typora-user-images/image-20220925143219592.png)

这里的栈低地址为栈顶



指令执行方案

1.单指令周期

将较快的也延长到和最慢的一样长

![image-20220925143400451](/Users/apple/Library/Application Support/typora-user-images/image-20220925143400451.png)





2.多指令周期

对不同类型的指令选用不同的执行步骤来完成

![image-20220925143442007](/Users/apple/Library/Application Support/typora-user-images/image-20220925143442007.png)



3.流水线方案

![image-20220925143454126](/Users/apple/Library/Application Support/typora-user-images/image-20220925143454126.png)

使各个资源利用率提高



### 数据通路功能和基本结构



各个寄存器的流出和流入都与微操作信号发生器有关



**内部单总线方式**



寄存器之间的数据传送🌟

![image-20220925144828630](/Users/apple/Library/Application Support/typora-user-images/image-20220925144828630.png)

将哪个信号有效说明清楚



 ![image-20220925145153760](/Users/apple/Library/Application Support/typora-user-images/image-20220925145153760.png)

注意此刻的MDRin并不是cpu内部单总线，而是和主存之间的系统总线的控制



![image-20220925145459669](/Users/apple/Library/Application Support/typora-user-images/image-20220925145459669.png)

![image-20220925145512665](/Users/apple/Library/Application Support/typora-user-images/image-20220925145512665.png)



必须先将一个操作数放在暂存寄存器中，否则两个数无法同时在总线上传输





**专用数据通路方式**



![image-20220925150834091](/Users/apple/Library/Application Support/typora-user-images/image-20220925150834091.png)



取指周期

![image-20220925150933453](/Users/apple/Library/Application Support/typora-user-images/image-20220925150933453.png)





MAR与主存只能单向交互，只能MAR->MEM

MDR可以双向

能传送到微操作信号发生器的的寄存器是IR



### 控制器的功能和功罪原理



**控制周期的结构和功能**



![image-20220926211846334](/Users/apple/Library/Application Support/typora-user-images/image-20220926211846334.png)

四个触发器表示处于哪个周期



![image-20220926212259086](/Users/apple/Library/Application Support/typora-user-images/image-20220926212259086.png)



硬布线控制器

![image-20220926213630890](/Users/apple/Library/Application Support/typora-user-images/image-20220926213630890.png)





分析每个阶段的微操作序列



![image-20220926214716674](/Users/apple/Library/Application Support/typora-user-images/image-20220926214716674.png)



ACC简写为AC



![image-20220926214940081](/Users/apple/Library/Application Support/typora-user-images/image-20220926214940081.png)



为了找到一个微操作在那个位置会使用









安排微操作时序的原则

![image-20220926215315430](/Users/apple/Library/Application Support/typora-user-images/image-20220926215315430.png)



![image-20220926215500182](/Users/apple/Library/Application Support/typora-user-images/image-20220926215500182.png)

4.5是处理同一对象，但是占用时间较短，所以可以一个节拍内完成



![image-20220926215714029](/Users/apple/Library/Application Support/typora-user-images/image-20220926215714029.png)



![image-20220926215855357](/Users/apple/Library/Application Support/typora-user-images/image-20220926215855357.png)





电路设计

 

![image-20220926220152462](/Users/apple/Library/Application Support/typora-user-images/image-20220926220152462.png)

![image-20220926220307670](/Users/apple/Library/Application Support/typora-user-images/image-20220926220307670.png)

![image-20220926220451174](/Users/apple/Library/Application Support/typora-user-images/image-20220926220451174.png)



![image-20220926221013815](/Users/apple/Library/Application Support/typora-user-images/image-20220926221013815.png)





**微程序控制器**



![image-20220926221835790](/Users/apple/Library/Application Support/typora-user-images/image-20220926221835790.png)

采用存储程序思想

将所有指令的微程序存入控制器存储器中



指令是对微指令功能的封装

![image-20220926222115602](/Users/apple/Library/Application Support/typora-user-images/image-20220926222115602.png)





 ![image-20220928075527066](/Users/apple/Library/Application Support/typora-user-images/image-20220928075527066.png)



由于取指都一样，所以共享相同的微程序



![image-20220928075940627](/Users/apple/Library/Application Support/typora-user-images/image-20220928075940627.png)





![image-20220928080106839](/Users/apple/Library/Application Support/typora-user-images/image-20220928080106839.png)

一条指令对应一个微程序这个说法也正确





**微指令的格式**

1.水平型微指令

一个微指令能定义多个可并行的微指令

![image-20220928081532462](/Users/apple/Library/Application Support/typora-user-images/image-20220928081532462.png)



2.垂直型微指令

一条微指令只能定义一个微命令，由微操作码字段规定具体功能

![image-20220928081627518](/Users/apple/Library/Application Support/typora-user-images/image-20220928081627518.png)



3.混合型微指令

在垂直型的基础上怎加一些不太复杂的并行操作，微指令较短，仍便于编写微指令也不太长，执行速度快









**微指令的编码方式**



1.水平型



直接编码（直接控制）

每一位操作控制代表一个微操作命令

![image-20220928082053031](/Users/apple/Library/Application Support/typora-user-images/image-20220928082053031.png)



字段直接编码方式

![image-20220928082325516](/Users/apple/Library/Application Support/typora-user-images/image-20220928082325516.png)

![image-20220928082534253](/Users/apple/Library/Application Support/typora-user-images/image-20220928082534253.png)



字段简介编码方式



![image-20220928082627326](/Users/apple/Library/Application Support/typora-user-images/image-20220928082627326.png)





**下地址形成方式**

![image-20220928082920471](/Users/apple/Library/Application Support/typora-user-images/image-20220928082920471.png)





微程序控制单元的设计

![image-20220928084544879](/Users/apple/Library/Application Support/typora-user-images/image-20220928084544879.png)



取指周期

![image-20220928084952921](/Users/apple/Library/Application Support/typora-user-images/image-20220928084952921.png)



![image-20220928085305512](/Users/apple/Library/Application Support/typora-user-images/image-20220928085305512.png)

![image-20220928085526741](/Users/apple/Library/Application Support/typora-user-images/image-20220928085526741.png)



微程序设计分类

静态 ROM

动态 

![image-20220928085853257](/Users/apple/Library/Application Support/typora-user-images/image-20220928085853257.png)

![image-20220928085948740](/Users/apple/Library/Application Support/typora-user-images/image-20220928085948740.png)



### 指令流水线



指令流水的定义

![image-20220928090537009](/Users/apple/Library/Application Support/typora-user-images/image-20220928090537009.png)



![image-20220928090632493](/Users/apple/Library/Application Support/typora-user-images/image-20220928090632493.png)

优点是控制简单，硬件代价小

缺点是指令执行速度慢，在任何时候只有一条指令执行，各个部件的利用率较低



![image-20220928090830388](/Users/apple/Library/Application Support/typora-user-images/image-20220928090830388.png)



![image-20220928090936810](/Users/apple/Library/Application Support/typora-user-images/image-20220928090936810.png)

同一时刻可能存在多个不同阶段的指令正在执行





指令流水线的性能指标

**吞吐率**：单位时间流水线完成的任务数量或是输出结果的数量

=指令条数/执行完的时间

![image-20220928091616050](/Users/apple/Library/Application Support/typora-user-images/image-20220928091616050.png)

**加速比**

不使用流水线所用时间与使用流水线所用时间比

![image-20220928091744903](/Users/apple/Library/Application Support/typora-user-images/image-20220928091744903.png)

极限k



**效率**：流水线设备的利用率

![image-20220928092008716](/Users/apple/Library/Application Support/typora-user-images/image-20220928092008716.png)





**影响流水线的因素**



五个阶段（MIPS架构）

IF取指

ID译码/读寄存器

EX执行/计算地址

MEM访存

WB写回



![image-20220928092758536](/Users/apple/Library/Application Support/typora-user-images/image-20220928092758536.png)



印象流水线因素

![image-20220928093329949](/Users/apple/Library/Application Support/typora-user-images/image-20220928093329949.png)

![image-20220928093526936](/Users/apple/Library/Application Support/typora-user-images/image-20220928093526936.png)



![image-20220928093847573](/Users/apple/Library/Application Support/typora-user-images/image-20220928093847573.png)

![image-20220928093953514](/Users/apple/Library/Application Support/typora-user-images/image-20220928093953514.png)

![image-20220928094003257](/Users/apple/Library/Application Support/typora-user-images/image-20220928094003257.png)

![image-20220928094112566](/Users/apple/Library/Application Support/typora-user-images/image-20220928094112566.png)



![image-20220928094219971](/Users/apple/Library/Application Support/typora-user-images/image-20220928094219971.png)

着重探讨由转移指令引发的

![image-20220928094512562](/Users/apple/Library/Application Support/typora-user-images/image-20220928094512562.png)



流水线的分类

![image-20220928094828247](/Users/apple/Library/Application Support/typora-user-images/image-20220928094828247.png)

![image-20220928094843605](/Users/apple/Library/Application Support/typora-user-images/image-20220928094843605.png)

![image-20220928094929948](/Users/apple/Library/Application Support/typora-user-images/image-20220928094929948.png)

![image-20220928094936160](/Users/apple/Library/Application Support/typora-user-images/image-20220928094936160.png)



多发技术

![image-20220928095227959](/Users/apple/Library/Application Support/typora-user-images/image-20220928095227959.png)

 ![image-20220928101922582](/Users/apple/Library/Application Support/typora-user-images/image-20220928101922582.png)

类似时分复用技术

![image-20220928101957676](/Users/apple/Library/Application Support/typora-user-images/image-20220928101957676.png)

![image-20220928102106372](/Users/apple/Library/Application Support/typora-user-images/image-20220928102106372.png)



![image-20220928102143700](/Users/apple/Library/Application Support/typora-user-images/image-20220928102143700.png)







五段式流水线

![image-20220928102319155](/Users/apple/Library/Application Support/typora-user-images/image-20220928102319155.png)





运算类指令

![image-20220928102730923](/Users/apple/Library/Application Support/typora-user-images/image-20220928102730923.png)

LOAD指令

取出内存中的数

![image-20220928102851089](/Users/apple/Library/Application Support/typora-user-images/image-20220928102851089.png)



![image-20220928103005597](/Users/apple/Library/Application Support/typora-user-images/image-20220928103005597.png)

![image-20220928103056359](/Users/apple/Library/Application Support/typora-user-images/image-20220928103056359.png)



STORE指令

存数指令

![image-20220928103116782](/Users/apple/Library/Application Support/typora-user-images/image-20220928103116782.png)

![image-20220928103318517](/Users/apple/Library/Application Support/typora-user-images/image-20220928103318517.png)



条件转移指令

通常用相对寻址

![image-20220928103739767](/Users/apple/Library/Application Support/typora-user-images/image-20220928103739767.png)

![image-20220928103753701](/Users/apple/Library/Application Support/typora-user-images/image-20220928103753701.png)



无条件转移指令

![image-20220928104017611](/Users/apple/Library/Application Support/typora-user-images/image-20220928104017611.png)

![image-20220928104149649](/Users/apple/Library/Application Support/typora-user-images/image-20220928104149649.png)

尽早的修改PC的值





### 多处理器基本概念



![image-20220928143609418](/Users/apple/Library/Application Support/typora-user-images/image-20220928143609418.png)

SISD采用多模块交叉存储器



![image-20220928143708287](/Users/apple/Library/Application Support/typora-user-images/image-20220928143708287.png)

数据可以并行

![image-20220928143814180](/Users/apple/Library/Application Support/typora-user-images/image-20220928143814180.png)

![image-20220928143936470](/Users/apple/Library/Application Support/typora-user-images/image-20220928143936470.png)





MISD（多条指令并行）现实中不存在



MIND（多指令流，多数据流）



![image-20220928144212011](/Users/apple/Library/Application Support/typora-user-images/image-20220928144212011.png)

共享存储多处理器系统





![image-20220928145026590](/Users/apple/Library/Application Support/typora-user-images/image-20220928145026590.png)



![image-20220928145142978](/Users/apple/Library/Application Support/typora-user-images/image-20220928145142978.png)



**硬件多线程**



![image-20220928145552054](/Users/apple/Library/Application Support/typora-user-images/image-20220928145552054.png)









## 第六章	总线



### 总线概述



![image-20220928220239065](/Users/apple/Library/Application Support/typora-user-images/image-20220928220239065.png)

![image-20220928220331626](/Users/apple/Library/Application Support/typora-user-images/image-20220928220331626.png)



![image-20220928220349198](/Users/apple/Library/Application Support/typora-user-images/image-20220928220349198.png)



![image-20220928220645542](/Users/apple/Library/Application Support/typora-user-images/image-20220928220645542.png)

![image-20220928220732925](/Users/apple/Library/Application Support/typora-user-images/image-20220928220732925.png)



![image-20220928221123559](/Users/apple/Library/Application Support/typora-user-images/image-20220928221123559.png)





系统总线结构

单总线：由地址，数据，控制三种组成

![image-20220928221346278](/Users/apple/Library/Application Support/typora-user-images/image-20220928221346278.png)



双总线

![image-20220928221625138](/Users/apple/Library/Application Support/typora-user-images/image-20220928221625138.png)

突发猝发



三总线

![image-20220928221817076](/Users/apple/Library/Application Support/typora-user-images/image-20220928221817076.png)

三个总线同一时刻只有一个可以工作





总线性能指标

![image-20220928222309709](/Users/apple/Library/Application Support/typora-user-images/image-20220928222309709.png)



![image-20220928222329173](/Users/apple/Library/Application Support/typora-user-images/image-20220928222329173.png)



![image-20220928222402915](/Users/apple/Library/Application Support/typora-user-images/image-20220928222402915.png)

也许不是所有信息都是有效信息



![image-20220929063319617](/Users/apple/Library/Application Support/typora-user-images/image-20220929063319617.png)





![image-20220929063546560](/Users/apple/Library/Application Support/typora-user-images/image-20220929063546560.png)





总线仲裁

解决多个设备竞争总线的问题



![image-20220929064420115](/Users/apple/Library/Application Support/typora-user-images/image-20220929064420115.png)

链式查询

![image-20220929064523047](/Users/apple/Library/Application Support/typora-user-images/image-20220929064523047.png)



![image-20220929064923197](/Users/apple/Library/Application Support/typora-user-images/image-20220929064923197.png)

计数器查询

![image-20220929064941050](/Users/apple/Library/Application Support/typora-user-images/image-20220929064941050.png)





![image-20220929065159759](/Users/apple/Library/Application Support/typora-user-images/image-20220929065159759.png)

独立请求方式





总线忙的信号由占用总线的设备发出





### 总线事务和定时



![image-20220929070107420](/Users/apple/Library/Application Support/typora-user-images/image-20220929070107420.png)





同步定时

![image-20220929070303239](/Users/apple/Library/Application Support/typora-user-images/image-20220929070303239.png)

![image-20220929070500930](/Users/apple/Library/Application Support/typora-user-images/image-20220929070500930.png)



异步定时

![image-20220929070816091](/Users/apple/Library/Application Support/typora-user-images/image-20220929070816091.png)

![image-20220929070928977](/Users/apple/Library/Application Support/typora-user-images/image-20220929070928977.png)





总线标准

![image-20220929073310416](/Users/apple/Library/Application Support/typora-user-images/image-20220929073310416.png)

![image-20220929073544445](/Users/apple/Library/Application Support/typora-user-images/image-20220929073544445.png)













## 第七章	I/O系统



![image-20220929090305094](/Users/apple/Library/Application Support/typora-user-images/image-20220929090305094.png)

![image-20220929090652181](/Users/apple/Library/Application Support/typora-user-images/image-20220929090652181.png)

![image-20220929090751301](/Users/apple/Library/Application Support/typora-user-images/image-20220929090751301.png)





### I/O接口









### I/O方式



**程序查询方式**



![image-20220929132809243](/Users/apple/Library/Application Support/typora-user-images/image-20220929132809243.png)





对慢速I/O设备可行，但是对于快速I/O设备而言不可行

![image-20220929133327349](/Users/apple/Library/Application Support/typora-user-images/image-20220929133327349.png)



CPU不停的查询叫做独占查询，也可以定时查询





**程序中断方式**







![image-20220929134117915](/Users/apple/Library/Application Support/typora-user-images/image-20220929134117915.png)



![image-20220929134108512](/Users/apple/Library/Application Support/typora-user-images/image-20220929134108512.png)





![image-20220929134711440](/Users/apple/Library/Application Support/typora-user-images/image-20220929134711440.png)



软件实现比硬件实现要慢



![image-20220929135127078](/Users/apple/Library/Application Support/typora-user-images/image-20220929135127078.png)







![image-20220929135827258](/Users/apple/Library/Application Support/typora-user-images/image-20220929135827258.png)



![image-20220929140812032](/Users/apple/Library/Application Support/typora-user-images/image-20220929140812032.png)







![image-20220929141209587](/Users/apple/Library/Application Support/typora-user-images/image-20220929141209587.png)



![image-20220929141334892](/Users/apple/Library/Application Support/typora-user-images/image-20220929141334892.png)







![image-20220929143946296](/Users/apple/Library/Application Support/typora-user-images/image-20220929143946296.png)







![image-20220929144739037](/Users/apple/Library/Application Support/typora-user-images/image-20220929144739037.png)











## 选择题记录

### 第一章

1）控制流驱动：取出指令指引计算机去取出数据

![image-20220919165202771](/Users/apple/Library/Application Support/typora-user-images/image-20220919165202771.png)

![image-20220919165210759](/Users/apple/Library/Application Support/typora-user-images/image-20220919165210759.png)

2）![image-20220919191906285](/Users/apple/Library/Application Support/typora-user-images/image-20220919191906285.png)

对汇编程序员来说通用寄存器和程序计数器是可见的

### 第二章

1）

![image-20220921191706633](/Users/apple/Library/Application Support/typora-user-images/image-20220921191706633.png)









### 第三章

1）![image-20220923154114848](/Users/apple/Library/Application Support/typora-user-images/image-20220923154114848.png)

地址线需要也需要多于行的引脚，因此使行列相差较小，又因为是按行刷新，行值应该小



### 第四章



### 第五章

![image-20220928161433080](/Users/apple/Library/Application Support/typora-user-images/image-20220928161433080.png)











